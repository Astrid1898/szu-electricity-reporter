# 微信提醒宿舍电量情况

*修改中*

## 简介

1. 使用 python 简单获取深圳大学特定的宿舍电量情况。
2. 借助 [Server 酱](http://sc.ftqq.com) 将电量情况发送至微信上。
3. 可配合定时任务完成每日电量提醒功能。

<br/>

## 提醒内容

- 每日使用电量情况
- 每日剩余电量情况
- 近几日电量详表
- 每日购入电量情况

<br/>

## 效果

微信信息提醒：

![msg.jpg](https://i.loli.net/2019/10/22/9pOLRsrvIWe5Tqn.jpg)

详细数据：

![detail.jpg](https://i.loli.net/2019/10/22/H2w1zFVvcltLjA6.jpg)

<br/>

## 项目结构

- [main.py](main.py)  
  主程序，**需要手动修改参数**，可选是否发送到微信

- [crawler.py](crawler.py)  
  发送电量查询请求并进行简单数据整理的代码，一般不用修改

- [scsender.py](scsender.py)  
  通过 Server 酱 进行微信提醒，一般不用修改

<br/>

## 使用方法

本程序非开箱即用，需要自己获得并修改对应参数，修改完成后每次只需运行 `main.py` 脚本即可。

环境：Anaconda、深大校内网

1. 修改 `main.py` 代码内容，将指定的参数修改为你对应的参数值

   参数值获取途径（以 Chrome 浏览器 为例）：

   校内网环境，点击<kbd>F12</kbd>键或空白处`右键-检查`打开开发者工具，选择 Network 选项卡，登录深大 [SIMS 电控网上查询系统](http://192.168.84.3:9090/cgcSims/)，填写宿舍信息后，随便选择开始时间、结束时间、查询类型，点击查询，在开发者工具中选择 `selectList.do` 文件，查看它的 POST 请求参数（如果没有则刷新页面）。

   ![network.jpg](https://ftp.bmp.ovh/imgs/2019/09/2021ada6023d5368.jpg)

   将 `main.py` 文件内的参数对应地替换为图中红框所包含的 `client`、`roomId`、`roomName` 参数即可。

2. 注册 Server 酱 账号，绑定微信并获得 SCKEY 完成设置

   （为避免日后版本更新，以官网教程为准。）

   ![serverChan.jpg](https://ftp.bmp.ovh/imgs/2019/09/274ff356c8a14998.jpg)

   打开 [Server 酱](http://sc.ftqq.com/) 官网，选择`登入`，自动 github 账号授权登录。

   然后选择`微信推送`，扫码绑定微信，关注公众号。

   然后复制`发送信息`的 `SCKEY` 码，替换 `main.py` 中的 `sc_key` 参数即可。

3. 运行 `main.py` 程序即可收到微信提醒，控制台亦有相关信息输出

4. Windows 系统可以设置 `计划任务` 定时运行该脚本，达到每日提醒的效果~（具体方法略，个人配置参考如下）

   ![Task Scheduler.jpg](https://i.loli.net/2019/10/25/93JpyXjEvGKDkli.jpg)

   ![run.jpg](https://i.loli.net/2019/10/25/QYAdxJuFnBIOPp7.jpg)

   **注意**：虽然电费查询系统上显示的记录是每日凌晨的数据，但是网页数据往往要等到下午（接近 15 点）才会更新，所以如果在这之前运行脚本，则只能获得昨日的电量数据，故请自行安排使用该脚本的策略~

<br/>

## 更新日志

### 2021-01-13

- 将需要手动修改的配置抽取为 config.json 配置文件

### 2019-10-25

- 修复永远显示“数据未更新”的 bug
- 修复控制台打印电量信息错误的问题
- 添加个人的计划任务配置参考图片

### 2019-10-22

- 完善了代码，改用字典存储
- 添加了部分注释便于阅读
- 修改了某些糟糕的代码写法
- 修改返回数据格式为“| 日期 | 今日用电 | 可用电量 | 今日充电 |”更加实用
- 修改了表格样式为居中对齐，效果相对有所改善
- 增加了爬取数据失败的提示

### 2019-09-24

添加判断是否充电并输出昨日充电额度

### 2019-09-23

发布项目

<br/>
